<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM de Clientes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

    <!-- Firebase SDK - Versão 9.6.0 compat -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script> <!-- Adicionado Firebase Auth -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #1f2937; /* Texto cinza escuro padrão */
            margin: 0; /* Reset margin for full width */
        }
        #crmApp {
            max-width: none !important; /* Override max-w */
            width: 100% !important; /* Ensure full width */
            margin: 0 auto; /* Center if needed */
            padding: 1rem; /* Add some padding around the app */
        }
        @media (min-width: 640px) { /* sm */
            #crmApp {
                padding: 2rem;
            }
        }
        @media (min-width: 768px) { /* md */
            #crmApp {
                padding: 3rem;
            }
        }
        /* Estilo para a coluna fixa */
        #clientTable th:first-child {
            position: sticky;
            left: 0;
            background-color: #f3f4f6; /* Define explicitamente o fundo para o thead fixo */
            z-index: 2; /* Increased z-index to ensure it's always on top */
            border-right: 1px solid #e5e7eb; /* Opcional: Adiciona uma linha separadora */
        }
        #clientTable td:first-child {
            position: sticky;
            left: 0;
            /* background-color será definido via JS para acompanhar a cor da linha */
            z-index: 1; /* Garante que fique acima de outras células durante a rolagem, mas abaixo do thead sticky */
            border-right: 1px solid #e5e7eb; /* Opcional: Adiciona uma linha separadora */
        }
        /* Ajusta o padding para alinhamento visual com a coluna fixa */
        #clientTable th:not(:first-child),
        #clientTable td:not(:first-child) {
            padding-left: 1rem; /* Ajusta conforme necessário */
        }
        /* Estilo para o spinner de carregamento */
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ffffff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 5px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Estilos para o modo de edição do formulário */
        .edit-mode-border {
            border: 2px solid #3b82f6; /* Borda azul para indicar modo de edição */
        }
        /* Estilos para campos de edição rápida na tabela */
        .quick-edit-container {
            display: flex;
            align-items: center;
            gap: 4px; /* Espaçamento entre o input e o botão */
            flex-wrap: nowrap; /* Impede que os itens quebrem para a próxima linha */
        }
        .quick-edit-input {
            flex-grow: 1; /* Permite que o input cresça para preencher o espaço */
            padding: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.75rem; /* text-sm */
            background-color: #f0f4f8; /* Um cinza claro para destacar */
        }
        /* Ajuste específico para o select de status na edição rápida */
        .quick-edit-status .quick-edit-input {
            min-width: 120px; /* Largura mínima para o select de status */
        }

        .quick-edit-btn {
            background-color: #10b981; /* Verde */
            color: white;
            padding: 4px 8px;
            border: none; /* Remove borda padrão */
            border-radius: 4px;
            font-size: 0.625rem; /* text-xs */
            cursor: pointer;
            flex-shrink: 0; /* Não encolhe o botão */
        }
        .quick-edit-btn:hover {
            background-color: #059669; /* Verde mais escuro */
        }
        /* Estilos para a barra de mensagens fixa */
        #messageBox {
            position: fixed !important; /* Força a posição fixa */
            bottom: 20px !important;
            right: 20px !important;
            z-index: 1000 !important;
            max-width: 300px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background-color: #333 !important; /* Fundo escuro para destacar */
            color: white !important; /* Texto branco */
            padding: 10px 15px; /* Mais padding para ser visível */
            border-radius: 8px; /* Cantos arredondados */
        }

        /* Novas classes para destaque de linhas */
        .in-progress-row { /* Adicionado para status 'Em Andamento' */
            background-color: #fffde7; /* Amarelo claro */
        }
        .meeting-scheduled-row {
            background-color: #fffbeb; /* bg-amber-100 */
        }
        .contract-signed-row {
            background-color: #dcfce7; /* bg-green-100 */
        }
        /* Garante que o background padrão da linha seja branco, se não for sobrescrito */
        #clientTable tbody tr {
            /* background-color será definido no JS via classes Tailwind */
        }

        /* Estilos para o modal de confirmação */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 44px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .modal-button {
            /* REMOVIDO: padding: 8px 15px; */
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .modal-button.confirm {
            background-color: #ef4444; /* red-500 */
            color: white;
        }

        .modal-button.cancel {
            background-color: #6b7280; /* gray-500 */
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    
    <div id="crmApp" class="bg-white rounded-xl shadow-lg">
        <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 py-6">Cadastro de Clientes CRM</h1>

        <div class="mb-6 p-4 md:p-6 bg-white rounded-lg border border-gray-200">
            <label for="rawDataInput" class="block text-lg font-semibold text-gray-700 mb-3">
                Cole os dados do Google Meu Negócio aqui:
            </label>
            <textarea id="rawDataInput" rows="6" md:rows="8" data-mode="stopped"
                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-900 placeholder-gray-400"
                      placeholder="Ex: Nome da Empresa: Minha Loja Ltda.&#10;Telefone: (11) 98765-4321&#10;Site: www.minhaloja.com.br&#10;Endereço: Rua Exemplo, 123, Centro, Cidade - SP&#10;Email: contato@minhaloja.com.br&#10;Nome de Contato: João Silva&#10;Data do Primeiro Contato: 2024-07-01&#10;Data da Consultoria Gratuita: 2024-07-05&#10;Horário da Consultoria Gratuita: 10:00&#10;Data da Segunda Reunião: 2024-07-10&#10;Horário da Segunda Reunião: 14:30&#10;Data de Início do Contrato: 2023-01-15&#10;Status: Novo Cliente&#10;Último Contato: 2023-05-15&#10;&#10;Dica para ditado por voz: Fale o nome do campo seguido da informação. Ex: 'Nome da empresa: Minha Loja Ltda. Telefone: 11 98765-4321.'"></textarea>
            
            <div class="mt-3 flex flex-col md:flex-row justify-center items-center gap-3">
                <button id="fillFormButton"
                        class="w-full md:w-40 py-2 px-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-md">
                    Preencher Formulário
                </button>
                <button id="voiceInputButton"
                        class="w-full md:w-40 py-2 px-3 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-md flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8V4a1 1 0 10-2 0v4a5 3 0 01-10 0V4a1 1 0 00-2 0v4a7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path>
                    </svg>
                </button>
                <button id="formatDataButton"
                        class="w-full md:w-40 py-2 px-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-md">
                    Formatar Dados
                </button>
            </div>
        </div>

        <div id="clientDetailsContainer" class="mb-6 p-4 md:p-6 bg-white rounded-xl border border-gray-200">
            <h2 class="text-xl md:text-2xl font-bold text-center text-gray-800 mb-4 md:mb-6">Detalhes do Cliente</h2>
            <form id="clientForm" class="grid grid-cols-1 gap-4 md:grid-cols-2 md:gap-6">
                <div>
                    <label for="companyName" class="block text-sm font-medium text-gray-700 mb-1">Nome da Empresa:</label>
                    <div class="flex items-center gap-2">
                        <input type="text" id="companyName" data-mode="stopped"
                               class="flex-1 p-2 md:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-900">
                        <button type="button" class="voice-field-button p-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition duration-150 ease-in-out" data-target-field="companyName">
                            <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8V4a1 1 0 10-2 0v4a5 3 0 01-10 0V4a1 1 0 00-2 0v4a7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div>
                    <label for="contactName" class="block text-sm font-medium text-gray-700 mb-1">Nome de Contato:</label>
                    <div class="flex items-center gap-2">
                        <input type="text" id="contactName" data-mode="stopped"
                               class="flex-1 p-2 md:p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-900">
                        <button type="button" class="voice-field-button p-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition duration-150 ease-in-out" data-target-field="contactName">
                            <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8V4a1 1 0 10-2 0v4a5 3 0 01-10 0V4a1 1 0 00-2 0v4a7.001 7.001 0 